<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=chrome">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Killer Boom Boom</title>

    <script src = "phaser.js"></script>
    <script src = "Animation.js"></script>
    <script src = "RunningImages.js"></script>
    <script src = "PlayerMovement.js"></script>
    <script src = "Spells.js"></script>
    <script src = "manaStar.js"></script>
    <script src = "MainCharacter.js"></script>
    <script src = "Walkers.js"></script>
    <script src = "GameManagerFunctions.js"></script>
    <script src = "Interface.js"></script>
    <script src = "GameManager.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script>
    var config = 
    {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                //gravity: { y: 300 },
                debug: true
            }
        },
        scene:
        {
            preload: preload,
            create: create,
            update: update
        }
    };  
var game = new Phaser.Game(config);

//characters
var player;
var zombies = [];

//Misc Stuff
var mana_Stars_In_Game = [];

//all the keys
let keyA;
let keyS;
let keyD;
let keyW;

//all the keys
let key1;
let key2;
let key3;
let key4;
let keySpace;

//Instantiating classes
let myGameManager = new GameManager();
let myMainMan = new MainMan();
let myInterface = new Interface();
let myManaStar = new manaStar();

//global array that checks which spell is pressed. Used in many scripts
let spells_Pressed = [false,false,false,false];
let mySpells = new Spells();

//The interface objects
let manaBar;
let healthBar;
let roundBar;
let zombieBar;

//this is used for the round bar
let currentRound = 1;

//All the timers
let timedEvent;
let damagingPlayer;
let Healing_Over_Time;

function preload ()
{
    //Loads the background
    preLoadAllStuff(this)
}

function create ()
{
    createTheBackground(this)
    //const text = this.add.text(350, 270, 'ppoooppp', { font: '16px Courier', fill: '#00ff00' });

    //intialising the interface bars for the player to see
    myInterface.displayManaBar(this);
    myInterface.displayHealthBar(this);
    myInterface.displayRoundBar(this);
    myInterface.displayZombieBar(this)

    //movement keys
    keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
    keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
    keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
    keyW = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);

    //selection of spells keys
    key1 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ONE);
    key2 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.TWO);
    key3 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.THREE);
    key4 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.FOUR);
    keyShift = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT);

    //dude
    player = this.physics.add.sprite(100, 450, 'dude');
    player.setCollideWorldBounds(true);
    
    //create the animation for the playable character
    mcAnim(this);

    //create the animation for the zombie. This applies to every zombie that i make.
    zombie_Movement(this);
    
    //create the cursors on the keyboard to be able to be inputted
    cursors = this.input.keyboard.createCursorKeys();

    //These are the timed events that keep looping functions every set interval
    //This recharges the mana every 1.5s. Calls the rechargeMana function which is in the "MainCharacter.js" file
    timedEvent = this.time.addEvent({ delay: 1500, callback: rechargeMana,args:[myMainMan], callbackScope: this, loop: true });
    //damages the player when he/she is hit, checks every second. Calls the damagePlayer function in "GameManagerFunctions.js"
    damagingPlayer = this.time.addEvent({ delay: 1000, callback: damagePlayer,args:[myGameManager], callbackScope: this, loop: true });
    /*heals the player every 10 seconds. Calls the rechargeHealth function which is in the "MainCharacter.js" file*/
    Healing_Over_Time = this.time.addEvent({ delay: 10000, callback: rechargeHealth,args:[myMainMan], callbackScope: this, loop: true });
    
}

function update ()
{
    //move the player with wasd and cursor keys. Check the PlayerMovement.js file for more info on how this works
    moveTheLad(player); 

    //checks if the zombies are dead to respawn them.
    myGameManager.spawning_And_Killing_Zombos(this.physics, Phaser.Math.RND, myGameManager);

    //If all the zombies the zombies are still alive
    if(!myGameManager.managingZombies.all_Zombies_Dead)
    {
        //Does the method in the GameManager class
        myGameManager.zombie_Stuff(this.physics);
    }

    //constantly updates the interface bars 
    myInterface.updateManaBar();
    myInterface.updateHealthBar();
    myInterface.updateRoundBar();
    myInterface.updateZombieBar();
    //myMainMan.rechargeMana();


    myGameManager.collecting_Stars(this.physics);
    
    //Allows the mc to dash this is in the "PlayerMovement.js" file
    dash_The_Lad();

    //allows the player to cast the spells. This is in "Spells.js"
    casting_Spells(this);

    //the old moving script which is cool and complex but most likely 0.1% less efficient than the moveTheLad()
    //var moveyGroovy = new imNotSeeingEnoughMovement(player);

    if(myMainMan.extraStats.health < 0)
    {
        return;
    }
}
</script> 
</body>
</html>